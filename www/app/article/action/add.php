<?phpdefined('IN_TS') or die('Access Denied.');//用户是否登录$userid = aac('user')->isLogin();switch($ts){	case "":				$cateid = intval($_GET['cateid']);				$arrCate = $new['article']->getArrCate();				$title = '发布文章';		include template('add');		break;			case "do":		$cateid = $_POST['cateid'];		$title	= trim($_POST['title']);		$content = trim($_POST['content']);		$addtime = date('Y-m-d H:i:s');				//过滤内容开始		textfilter($title);		textfilter($content);		textfilter($_POST['tag']);		//过滤内容结束				if($title=='' || $content=='') qiMsg("标题和内容都不能为空！");		if($TS_USER['user']['isadmin']==1){			$isaudit = 0;		}else{			$isaudit = 1;		}				$articleid = $new['article']->create('article',array(			'userid'=>$userid,			'cateid'=>$cateid,			'title'=>$title,			'content'=>$content,			'isaudit'=>$isaudit,			'addtime'=>date('Y-m-d H:i:s'),		));				// 上传帖子图片开始		$arrUpload = tsUpload($_FILES['picfile'], $articleid, 'article', array('jpg', 'gif', 'png','jpeg'));		if ($arrUpload) {			$new['article'] -> update('article', array(				'articleid' => $articleid,			), array(				'path' => $arrUpload['path'],				'photo' => $arrUpload['url'],			));		} 		// 上传帖子图片结束				//处理标签		aac('tag')->addTag('article','articleid',$articleid,$_POST['tag']);				header("Location: ".SITE_URL.tsUrl('article','show',array('id'=>$articleid)));			break;	}